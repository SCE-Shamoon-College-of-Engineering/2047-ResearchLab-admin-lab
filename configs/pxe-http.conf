# Bind only to the lab NIC
interface=enp0s31f6
bind-interfaces
no-resolv
except-interface=lo

# We do NOT provide DNS; silence resolvconf warnings
port=0

# FortiGate provides IPs → we act as Proxy-DHCP (PXE options only)
dhcp-range=192.168.1.0,proxy

# --- UEFI architecture matches ---
# 16 = UEFI HTTPClient, 7 = x86_64 UEFI, 6 = IA32 UEFI
dhcp-match=set:efihttp,option:client-arch,16
dhcp-match=set:efi64, option:client-arch,7
dhcp-match=set:efi32, option:client-arch,6

# Primary path: native UEFI HTTPBoot
dhcp-boot=tag:efihttp,http://192.168.1.250/EFI/BOOT/bootx64.efi

# Fallback path: legacy PXE → iPXE → HTTP
enable-tftp
tftp-root=/srv/tftp
pxe-service=X86PC,"iPXE network boot",ipxe.efi

# When a client is already iPXE, hand it an HTTP script
dhcp-userclass=set:ipxe,iPXE
dhcp-boot=tag:ipxe,http://192.168.1.250/boot.ipxe

# Logging (very helpful during bring-up)
log-dhcp
log-queries
log-facility=/var/log/dnsmasq.log
