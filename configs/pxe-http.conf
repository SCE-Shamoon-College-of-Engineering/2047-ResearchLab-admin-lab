# Bind only to the lab interface (actual NIC)
interface=enp0s31f6
bind-interfaces
no-resolv
except-interface=lo

# We do NOT provide DNS; silence resolvconf warning
port=0

# --- UEFI architecture matches ---
#  7 = x86_64 UEFI, 6 = IA32 UEFI, 16 = UEFI HTTP client
dhcp-match=set:efi64,option:client-arch,7
dhcp-match=set:efi32,option:client-arch,6
dhcp-match=set:efihttp,option:client-arch,16

# --- Primary path: native UEFI HTTPBoot (if firmware supports it) ---
dhcp-boot=tag:efihttp,http://192.168.1.250/EFI/BOOT/bootx64.efi

# --- Fallback path: classic PXE → iPXE → HTTP ---
# Serve iPXE loader over TFTP for UEFI machines that don't speak HTTPBoot
pxe-service=tag:efi64,X86-64 UEFI iPXE,ipxe.efi
pxe-service=tag:efi32,IA32 UEFI iPXE,ipxe.efi
enable-tftp
tftp-root=/srv/tftp

# When the client is already iPXE, hand it an HTTP script
dhcp-userclass=set:ipxe,iPXE
dhcp-boot=tag:ipxe,http://192.168.1.250/boot.ipxe

# FortiGate is the DHCP server → we act as Proxy-DHCP only
dhcp-range=192.168.1.0,proxy

# Logging (helpful during bring-up)
log-dhcp
log-queries
log-facility=/var/log/dnsmasq.log
